const u=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}};u();class d{constructor(e){this.position=e}update(e){}draw(e,t){}keyboard_event_down(e){}keyboard_event_up(e){}}const c=i=>i*Math.PI/180,m=i=>i.x<1e3&&i.x>0&&i.y<1e3&&i.y>0,f="/pacman-vite-cnwdpt0622/assets/ferrari.27cefde0.png";var h=(i=>(i[i.UP=0]="UP",i[i.DOWN=1]="DOWN",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT",i))(h||{});const y={ArrowUp:0,ArrowDown:1,ArrowLeft:2,ArrowRight:3};class g extends d{constructor(e,t,s){super(e),this.carSize=t,this.color="red",this.angle=45,this.angleSpeed=0,this.carSpeed=0,this.carAcceleration=0,this.image=new Image,this.image.src=f,this.keyboardMap=s}update(e){this.angle+=this.angleSpeed*e,this.angleSpeed*=.9,this.carSpeed=this.carSpeed*.9+this.carAcceleration;let t={x:this.position.x+Math.cos(c(this.angle))*this.carSpeed*e,y:this.position.y+Math.sin(c(this.angle))*this.carSpeed*e};m(t)&&(this.position=t)}draw(e,t){e.fillStyle=this.color,e.translate(this.position.x,this.position.y),e.rotate(c(this.angle)),e.rotate(c(180)),e.drawImage(this.image,-this.carSize.height/2,-this.carSize.width/2,this.carSize.height,this.carSize.width)}keyboard_event_down(e){const t=this.keyboardMap[e];t===h.LEFT?this.angleSpeed=-300:t===h.RIGHT?this.angleSpeed=300:t===h.UP?this.carAcceleration=100:t===h.DOWN&&(this.carAcceleration=-100)}keyboard_event_up(e){const t=this.keyboardMap[e];t===h.LEFT?this.angleSpeed=-100:t===h.RIGHT?this.angleSpeed=100:(t===h.UP||t===h.DOWN)&&(this.carAcceleration=0)}}class w extends d{constructor(e){super(e)}draw(e,t){const s=(1/t).toFixed(2);e.font="50px Arial",e.fillStyle="black",e.fillText(`FPS: ${s}`,this.position.x,this.position.y)}}const S="/pacman-vite-cnwdpt0622/assets/pacman.0e51210e.png";class x extends d{constructor(e,t="yellow",s=100){super(e),this.pacmanSize=100,this.color=t,this.maxSpeed=s,this.speed={x:this.maxSpeed,y:0},this.direction=0,this.image=new Image,this.image.src=S,this.timer=0,this.sxParameters=[4,5,6,7,6,5],this.xFrame=0,this.yFrame=7}update(e){let t=this.position.x+this.speed.x*e;t+this.pacmanSize<=1e3&&t-this.pacmanSize>=0&&(this.position.x=t);let s=this.position.y+this.speed.y*e;s+this.pacmanSize<=1e3&&s-this.pacmanSize>=0&&(this.position.y=s),this.timer+=e,this.timer>=.05&&(this.xFrame=(this.xFrame+1)%this.sxParameters.length,this.timer=0)}draw(e,t){e.strokeStyle="black",e.lineWidth=1,e.fillStyle=this.color,e.translate(this.position.x,this.position.y),e.drawImage(this.image,32*this.sxParameters[this.xFrame]+3.5,31*this.yFrame,25,25,0,0,this.pacmanSize,this.pacmanSize)}keyboard_event_down(e){switch(e){case"ArrowDown":console.log("down"),this.speed.x=0,this.speed.y=this.maxSpeed,this.yFrame=6,this.sxParameters=[0,1,2,3,2,1];break;case"ArrowUp":console.log("up"),this.speed.x=0,this.speed.y=-this.maxSpeed,this.yFrame=7,this.sxParameters=[0,1,2,3,2,1];break;case"ArrowLeft":console.log("left"),this.speed.x=-this.maxSpeed,this.speed.y=0,this.direction=180,this.yFrame=6,this.sxParameters=[4,5,6,7,6,5];break;case"ArrowRight":console.log("right"),this.speed.x=this.maxSpeed,this.speed.y=0,this.yFrame=7,this.sxParameters=[4,5,6,7,6,5],this.direction=0;break;default:console.log("Key not valid");break}}}class b extends d{constructor(e,t,s,r,a){super(e),this.width=t,this.angle=s,this.actor=r,this.touched=!1,this.index=a}update(e){const t=this.actor.position,s=this.position;Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2))<30&&p.touchingBarrier(this.index)&&(this.touched=!0)}draw(e,t){e.strokeStyle=this.touched?"red":"green",e.lineWidth=1,e.beginPath(),e.translate(this.position.x,this.position.y),e.rotate(c(this.angle)),e.moveTo(-this.width/2,0),e.lineTo(this.width/2,0),e.arc(0,0,3,0,c(360)),e.closePath(),e.stroke(),e.fill()}}class k extends d{constructor(e){super({x:700,y:50});let t=[],s={x:500,y:500},r=400;const a=4;for(let o=0;o<a;o++){let n=360/a*o;t.push(new b({x:s.x+Math.cos(c(n))*r,y:s.y+Math.sin(c(n))*r},100,n,e,o))}this.barriers=t,this.currentBarrier=0,this.currentLap=0}touchingBarrier(e){return this.currentBarrier===e?(this.currentBarrier++,this.currentBarrier===this.barriers.length?(this.addLap(),!1):!0):!1}addLap(){this.currentLap++,this.currentBarrier=0,this.barriers.forEach(e=>e.touched=!1),this.currentLap>2&&alert("You won")}draw(e,t){e.font="50px Arial",e.fillStyle="black",e.fillText(`LAPS: ${this.currentLap}/3`,this.position.x,this.position.y)}}let p;const P=i=>{p=new k(i)};window.onload=()=>{const e=document.getElementById("canvas").getContext("2d"),t=new g({x:100,y:100},{width:50,height:100},y);P(t);const s=[new w({x:0,y:60}),new x({x:100,y:100})];let r=0;const a=o=>{let n=(o-r)/1e3;r=o,s.forEach(l=>l.update(n)),e.clearRect(0,0,1024,1024),s.forEach(l=>{e.save(),l.draw(e,n),e.restore()}),window.requestAnimationFrame(a)};window.requestAnimationFrame(a),document.body.addEventListener("keydown",o=>{s.forEach(n=>{n.keyboard_event_down(o.key)})}),document.body.addEventListener("keyup",o=>{s.forEach(n=>{n.keyboard_event_up(o.key)})})};
